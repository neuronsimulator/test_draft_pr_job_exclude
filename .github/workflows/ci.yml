name: Test CI

concurrency:
  group: ${{ github.workflow }}#${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches:
      - main

jobs:
  ci:
    runs-on: ${{ matrix.os }}
    name: ${{ matrix.os }} - ${{ matrix.config.foo }}
    strategy:
      matrix:
        os: [ macOS-11, ubuntu-20.04]
        config:
          - {"foo": "bar"}
          - {"foo": "baz"}
        include:
          - os: ubuntu-22.04
            config:
              foo: "fish"
    steps:
      - name: filter step
        if: github.event.pull_request.draft
        run: |
          echo "${{ matrix.os }}"
          echo "${{ matrix.config.foo }}"
          if ${{ matrix.os == 'ubuntu-20.04' }}; then
            exit 1
          fi
      - name: actual work
        run: |
          echo "${{needs.draft-pr-job-limiter.outputs.jobs}}"
          echo "doing real work here."
          sleep 60
          echo "done"
