name: Test CI

concurrency:
  group: ${{ github.workflow }}#${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches:
      - main

jobs:
  ci:
    runs-on: ${{ matrix.os }}
    name: ${{ matrix.os }} - ${{ matrix.config.foo }}
    strategy:
      matrix:
        os: [ macOS-11, ubuntu-20.04]
        config:
          - {"foo": "bar"}
          - {"foo": "baz"}
        include:
          - os: ubuntu-22.04
            config:
              foo: "fish"
    steps:
      - name: filter step
        id: run_on_this_platform
        if: ${{ !github.event.pull_request.draft || matrix.os == 'ubuntu-20.04' }}
        run: |
          echo "${{ matrix.os }}"
          echo "${{ matrix.config.foo }}"
      - name: actual work
        if: steps.run_on_this_platform.outcome == 'success'
        run: |
          echo "doing real work here."
          sleep 60
          echo "done"
